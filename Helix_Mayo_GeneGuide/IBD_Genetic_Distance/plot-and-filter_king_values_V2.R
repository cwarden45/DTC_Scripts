#setwd("E:\\WGS_Exome_Analysis\\My_Veritas_WGS\\Mayo_GeneGuide\\plink_IBD_Genetic_Distance")

#26,134 variants
new.sampleIDs =  c("GFG","CW23","Mayo")
K1G.ped.ref =  "../../23andMe/1000_Genomes/20140502_all_samples.ped"
input.king =  "1000_genomes_20140502_plus_2-SNP-chip_plus_Mayo-Exome.kin0"
output.prefix = "plink_kinship_2-SNP-chip_plus_2-SNP-chip_plus_Mayo-Exome"

#17,943 variants
#new.sampleIDs =  c("GFG","CW23","Genos.BWA")
#K1G.ped.ref =  "../../23andMe/1000_Genomes/20140502_all_samples.ped"
#input.king =  "1000_genomes_20140502_plus_2-SNP-chip_plus_Genos-BWA-MEM-Exome.kin0"
#output.prefix = "plink_kinship_2-SNP-chip_plus_2-SNP-chip_plus_Genos-BWA-MEM-Exome"

#9,531 variants
#new.sampleIDs =  c("GFG","CW23","Mayo","Genos.BWA","Veritas")
#K1G.ped.ref =  "../../23andMe/1000_Genomes/20140502_all_samples.ped"
#input.king =  "1000_genomes_20140502_plus_2-SNP-chip_plus_Mayo-Exome_plus_Genos-BWA-MEM-Exome_plus_Veritas_WGS.kin0"
#output.prefix = "plink_kinship_2-SNP-chip_plus_Mayo-GeneGuide_plus_Genos-BWA-MEM-Exome_plus_Veritas_WGS"


kin.table = read.table(input.king, head=F, sep="\t")
names(kin.table) = c("FAM1","ID1","FAM2","ID2","nsnp","hethet","ibs0","kinship")

##for de-bugging
#kin.table=kin.table[1:100000,]

trio.members = c("HG00155","HG00248","HG00405","HG00408","HG00420","HG00423","HG00429",
					"HG00438","HG00444","HG00447","HG00450","HG00453","HG00459","HG00465",
					"HG00474","HG00477","HG00480","HG00502","HG00514","HG00526","HG00532",
					"HG00535","HG00538","HG00544","HG00552","HG00555","HG00558","HG00561",
					"HG00567","HG00579","HG00582","HG00585","HG00591","HG00594","HG00597",
					"HG00609","HG00612","HG00615","HG00621","HG00627","HG00630","HG00636",
					"HG00639","HG00642","HG00652","HG00655","HG00658","HG00664","HG00673",
					"HG00685","HG00691","HG00694","HG00700","HG00703","HG00706","HG00709",
					"HG00718","HG00733","HG00735","HG00738","HG00741","HG00867","HG01047",
					"HG01050","HG01053","HG01056","HG01062","HG01068","HG01071","HG01074",
					"HG01075","HG01081","HG01084","HG01087","HG01096","HG01099","HG01103",
					"HG01106","HG01109","HG01114","HG01126","HG01135","HG01138","HG01141",
					"HG01150","HG01169","HG01172","HG01175","HG01178","HG01184","HG01189",
					"HG01192","HG01199","HG01206","HG01243","HG01247","HG01249","HG01252",
					"HG01255","HG01258","HG01261","HG01273","HG01276","HG01279","HG01343",
					"HG01346","HG01349","HG01352","HG01355","HG01358","HG01361","HG01367",
					"HG01376","HG01379","HG01385","HG01391","HG01439","HG01442","HG01457",
					"HG01463","HG01466","HG01490","HG01493","HG01496","HG01499","HG01502",
					"HG01505","HG01508","HG01511","HG01514","HG01517","HG01520","HG01523",
					"HG01526","HG01529","HG01532","HG01538","HG01552","HG01567","HG01573",
					"HG01579","HG01603","HG01606","HG01609","HG01611","HG01614","HG01615",
					"HG01617","HG01621","HG01624","HG01627","HG01629","HG01630","HG01633",
					"HG01669","HG01671","HG01672","HG01674","HG01675","HG01677","HG01678",
					"HG01681","HG01683","HG01687","HG01696","HG01698","HG01699","HG01701",
					"HG01705","HG01708","HG01711","HG01748","HG01756","HG01763","HG01772",
					"HG01774","HG01775","HG01778","HG01780","HG01781","HG01783","HG01881",
					"HG01885","HG01887","HG01888","HG01891","HG01895","HG01897","HG01898",
					"HG01912","HG01916","HG01919","HG01922","HG01925","HG01928","HG01934",
					"HG01937","HG01940","HG01943","HG01946","HG01949","HG01952","HG01955",
					"HG01959","HG01969","HG01972","HG01975","HG01978","HG01981","HG01984",
					"HG01986","HG01988","HG01990","HG01993","HG01998","HG02004","HG02008",
					"HG02011","HG02013","HG02014","HG02017","HG02020","HG02023","HG02026",
					"HG02029","HG02032","HG02055","HG02058","HG02061","HG02070","HG02073",
					"HG02076","HG02079","HG02082","HG02085","HG02091","HG02106","HG02122",
					"HG02128","HG02131","HG02134","HG02137","HG02145","HG02148","HG02222",
					"HG02225","HG02231","HG02234","HG02237","HG02240","HG02257","HG02261",
					"HG02273","HG02279","HG02287","HG02293","HG02300","HG02303","HG02307",
					"HG02314","HG02317","HG02321","HG02372","HG02428","HG02451","HG02480",
					"HG02486","HG02514","HG02523","NA06991","NA06993","NA06997","NA07022",
					"NA07029","NA07048","NA07051","NA07348","NA07349","NA07357","NA07435",
					"NA11829","NA11831","NA11839","NA11843","NA11881","NA11891","NA11893",
					"NA11917","NA11919","NA11930","NA11992","NA11994","NA12003","NA12005",
					"NA12043","NA12045","NA12056","NA12144","NA12146","NA12154","NA12155",
					"NA12248","NA12264","NA12272","NA12274","NA12286","NA12329","NA12340",
					"NA12342","NA12347","NA12399","NA12485","NA12546","NA12716","NA12748",
					"NA12750","NA12760","NA12762","NA12775","NA12777","NA12812","NA12814",
					"NA12827","NA12829","NA12842","NA12872","NA12874","NA12889","NA12891",
					"NA18486","NA18487","NA18498","NA18501","NA18504","NA18507","NA18516",
					"NA18519","NA18522","NA18854","NA18857","NA18860","NA18863","NA18869",
					"NA18872","NA18875","NA18906","NA18911","NA18914","NA18925","NA18930",
					"NA18935","NA19094","NA19097","NA19100","NA19103","NA19109","NA19115",
					"NA19120","NA19123","NA19129","NA19132","NA19139","NA19142","NA19145",
					"NA19148","NA19151","NA19154","NA19161","NA19173","NA19174","NA19177",
					"NA19186","NA19191","NA19199","NA19202","NA19205","NA19208","NA19211",
					"NA19215","NA19223","NA19226","NA19237","NA19240","NA19249","NA19252",
					"NA19258","NA19331","NA19382","NA19434","NA19444","NA19453","NA19650",
					"NA19653","NA19656","NA19659","NA19662","NA19665","NA19671","NA19674",
					"NA19677","NA19680","NA19683","NA19686","NA19702","NA19705","NA19708",
					"NA19718","NA19721","NA19724","NA19727","NA19730","NA19733","NA19742",
					"NA19748","NA19751","NA19757","NA19760","NA19763","NA19766","NA19772",
					"NA19775","NA19778","NA19781","NA19784","NA19787","NA19790","NA19796",
					"NA19828","NA19836","NA19902","NA19915","NA19918","NA19919","NA19924",
					"NA19983","NA20128","NA20129","NA20277","NA20279","NA20284","NA20285",
					"NA20288","NA20290","NA20292","NA20295","NA20297","NA20300","NA20302",
					"NA20316","NA20319","NA20333","NA20335","NA20337","NA20343","NA20345",
					"NA20347","NA20350","NA20358","NA20360","NA20364","NA20413","NA20871",
					"NA20898","NA20910","HG00144","HG00247","HG00403","HG00404","HG00406",
					"HG00407","HG00418","HG00419","HG00421","HG00422","HG00427","HG00428",
					"HG00436","HG00437","HG00442","HG00443","HG00445","HG00446","HG00448",
					"HG00449","HG00451","HG00452","HG00457","HG00458","HG00463","HG00464",
					"HG00472","HG00473","HG00475","HG00476","HG00478","HG00479","HG00500",
					"HG00501","HG00512","HG00513","HG00524","HG00525","HG00530","HG00531",
					"HG00533","HG00534","HG00536","HG00537","HG00542","HG00543","HG00551",
					"HG00553","HG00554","HG00556","HG00557","HG00559","HG00560","HG00565",
					"HG00566","HG00577","HG00578","HG00580","HG00581","HG00583","HG00584",
					"HG00589","HG00590","HG00592","HG00593","HG00595","HG00596","HG00607",
					"HG00608","HG00610","HG00611","HG00613","HG00614","HG00619","HG00620",
					"HG00625","HG00626","HG00628","HG00629","HG00634","HG00635","HG00637",
					"HG00638","HG00640","HG00641","HG00650","HG00651","HG00653","HG00654",
					"HG00656","HG00657","HG00662","HG00663","HG00671","HG00672","HG00683",
					"HG00684","HG00689","HG00690","HG00692","HG00693","HG00698","HG00699",
					"HG00701","HG00702","HG00704","HG00705","HG00707","HG00708","HG00716",
					"HG00717","HG00731","HG00732","HG00734","HG00736","HG00737","HG00739",
					"HG00740","HG00866","HG01048","HG01049","HG01051","HG01052","HG01054",
					"HG01055","HG01060","HG01061","HG01066","HG01067","HG01069","HG01070",
					"HG01072","HG01073","HG01079","HG01080","HG01082","HG01083","HG01085",
					"HG01086","HG01094","HG01095","HG01097","HG01098","HG01101","HG01102",
					"HG01104","HG01105","HG01107","HG01108","HG01112","HG01113","HG01124",
					"HG01125","HG01133","HG01134","HG01136","HG01137","HG01139","HG01140",
					"HG01148","HG01149","HG01167","HG01168","HG01170","HG01171","HG01173",
					"HG01174","HG01176","HG01177","HG01182","HG01183","HG01187","HG01188",
					"HG01190","HG01191","HG01197","HG01198","HG01204","HG01205","HG01241",
					"HG01242","HG01100","HG01110","HG01111","HG01250","HG01251","HG01253",
					"HG01254","HG01256","HG01257","HG01259","HG01260","HG01271","HG01272",
					"HG01274","HG01275","HG01277","HG01278","HG01341","HG01342","HG01344",
					"HG01345","HG01347","HG01348","HG01350","HG01351","HG01353","HG01354",
					"HG01356","HG01357","HG01359","HG01360","HG01365","HG01366","HG01374",
					"HG01375","HG01377","HG01378","HG01383","HG01384","HG01389","HG01390",
					"HG01437","HG01438","HG01441","HG01455","HG01456","HG01461","HG01462",
					"HG01464","HG01465","HG01488","HG01489","HG01491","HG01492","HG01494",
					"HG01495","HG01497","HG01498","HG01500","HG01501","HG01503","HG01504",
					"HG01506","HG01507","HG01509","HG01510","HG01512","HG01513","HG01515",
					"HG01516","HG01518","HG01519","HG01521","HG01522","HG01524","HG01525",
					"HG01527","HG01528","HG01530","HG01531","HG01536","HG01537","HG01550",
					"HG01551","HG01565","HG01566","HG01571","HG01572","HG01577","HG01578",
					"HG01601","HG01604","HG01607","HG01608","HG01610","HG01613","HG01616",
					"HG01619","HG01620","HG01622","HG01625","HG01626","HG01628","HG01631",
					"HG01632","HG01667","HG01670","HG01673","HG01676","HG01679","HG01680",
					"HG01682","HG01685","HG01686","HG01694","HG01695","HG01697","HG01700",
					"HG01703","HG01706","HG01709","HG01710","HG01746","HG01747","HG01755",
					"HG01761","HG01762","HG01770","HG01771","HG01773","HG01776","HG01777",
					"HG01779","HG01782","HG01879","HG01880","HG01884","HG01886","HG01882",
					"HG01883","HG01889","HG01890","HG01894","HG01896","HG01892","HG01893",
					"HG01914","HG01915","HG01917","HG01918","HG01920","HG01921","HG01923",
					"HG01924","HG01926","HG01927","HG01932","HG01933","HG01935","HG01936",
					"HG01938","HG01939","HG01941","HG01942","HG01944","HG01945","HG01947",
					"HG01948","HG01950","HG01951","HG01953","HG01954","HG01958","HG01967",
					"HG01968","HG01970","HG01971","HG01973","HG01974","HG01976","HG01977",
					"HG01979","HG01980","HG01982","HG01983","HG01960","HG01987","HG01991",
					"HG01992","HG01997","HG02002","HG02003","HG02009","HG02010","HG02015",
					"HG02018","HG02021","HG02024","HG02027","HG02030","HG02053","HG02054",
					"HG02056","HG02059","HG02068","HG02071","HG02074","HG02077","HG02080",
					"HG02083","HG02089","HG02090","HG02104","HG02105","HG02120","HG02126",
					"HG02129","HG02132","HG02135","HG02143","HG02144","HG02146","HG02147",
					"HG02220","HG02221","HG02223","HG02224","HG02229","HG02232","HG02233",
					"HG02235","HG02236","HG02238","HG02239","HG02255","HG02256","HG02259",
					"HG02260","HG02271","HG02272","HG02277","HG02278","HG02285","HG02286",
					"HG02291","HG02292","HG02298","HG02299","HG02301","HG02302","HG02280",
					"HG02258","HG02316","HG02281","HG02282","HG02371","HG02420","HG02427",
					"HG02449","HG02450","HG02478","HG02479","HG02484","HG02485","HG02512",
					"HG02513","HG02521","HG02522","NA06985","NA06986","NA07019","NA06994",
					"NA07000","NA07034","NA07014","NA07345","NA07346","NA07347","NA06995",
					"NA10856","NA10855","NA10854","NA10853","NA10859","NA10865","NA10864",
					"NA10842","NA10843","NA10845","NA10860","NA10861","NA10838","NA10839",
					"NA10857","NA10852","NA10851","NA10846","NA10847","NA10830","NA10831",
					"NA10835","NA10863","NA10837","NA10836","NA10840","NA06984","NA06989",
					"NA12335","NA12336","NA12344","NA12386","NA12413","NA12414","NA12376",
					"NA12707","NA12739","NA12740","NA12752","NA12753","NA12766","NA12767",
					"NA12801","NA12802","NA12817","NA12818","NA12832","NA12864","NA12865",
					"NA12877","NA12878","NA18484","NA18485","NA18497","NA18500","NA18503",
					"NA18506","NA18515","NA18518","NA18521","NA18852","NA18853","NA18855",
					"NA18856","NA18858","NA18859","NA18861","NA18862","NA18867","NA18868",
					"NA18870","NA18871","NA18873","NA18874","NA18876","NA18877","NA18909",
					"NA18910","NA18912","NA18913","NA18923","NA18924","NA18916","NA18917",
					"NA18933","NA18934","NA19092","NA19093","NA19095","NA19096","NA19098",
					"NA19099","NA19101","NA19102","NA19107","NA19108","NA19113","NA19114",
					"NA19116","NA19119","NA19121","NA19122","NA19127","NA19128","NA19130",
					"NA19131","NA19137","NA19138","NA19140","NA19141","NA19143","NA19144",
					"NA19146","NA19147","NA19149","NA19150","NA19152","NA19153","NA19159",
					"NA19160","NA19171","NA19172","NA19117","NA19118","NA19175","NA19176",
					"NA19184","NA19185","NA19189","NA19190","NA19197","NA19198","NA19200",
					"NA19201","NA19203","NA19204","NA19206","NA19207","NA19209","NA19210",
					"NA19213","NA19214","NA19221","NA19224","NA19235","NA19236","NA19238",
					"NA19239","NA19247","NA19248","NA18907","NA19256","NA19257","NA19313",
					"NA19381","NA19432","NA19445","NA19648","NA19649","NA19651","NA19652",
					"NA19654","NA19655","NA19657","NA19658","NA19660","NA19661","NA19663",
					"NA19664","NA19669","NA19670","NA19672","NA19675","NA19676","NA19678",
					"NA19679","NA19681","NA19682","NA19684","NA19685","NA19700","NA19701",
					"NA19703","NA19704","NA19707","NA19716","NA19717","NA19719","NA19720",
					"NA19722","NA19723","NA19725","NA19726","NA19728","NA19729","NA19731",
					"NA19732","NA19740","NA19741","NA19746","NA19747","NA19749","NA19750",
					"NA19755","NA19756","NA19758","NA19759","NA19761","NA19762","NA19764",
					"NA19770","NA19771","NA19773","NA19774","NA19776","NA19777","NA19779",
					"NA19780","NA19782","NA19783","NA19785","NA19786","NA19788","NA19789",
					"NA19794","NA19795","NA19818","NA19819","NA19834","NA19835","NA19900",
					"NA19901","NA19914","NA19916","NA19917","NA19908","NA19909","NA19922",
					"NA19923","NA19713","NA19982","NA20126","NA20127","NA19920","NA19921",
					"NA20276","NA20278","NA20282","NA20287","NA20289","NA20291","NA20294",
					"NA20296","NA20299","NA20301","NA20314","NA20317","NA20332","NA20334",
					"NA20336","NA20342","NA20344","NA20346","NA20349","NA20356","NA20357",
					"NA20359","NA20363","NA20412","NA20868","NA20886","NA20909")

print(dim(kin.table))
total.IDs = c(trio.members, new.sampleIDs)
kin.table = kin.table[(kin.table$ID1 %in% total.IDs)&(kin.table$ID2 %in% total.IDs),]
print(dim(kin.table))

ped.table = read.table(K1G.ped.ref, head=T, sep="\t")

small.table = kin.table[(kin.table$ID1 %in% new.sampleIDs)&(kin.table$ID2 %in% new.sampleIDs),]
output.table = paste(output.prefix,"_stats.txt",sep="")
write.table(small.table, output.table, quote=F, sep="\t", row.names=F)

relationship.category = rep(NA,nrow(kin.table))
relationship.category[(kin.table$ID1 %in% new.sampleIDs)&(kin.table$ID2 %in% new.sampleIDs)] = "New"

for (i in 1:nrow(kin.table)){
	sample1 = as.character(kin.table$ID1[i])
	sample2 = as.character(kin.table$ID2[i])
	
	if((sample1 %in% ped.table$Individual.ID)&(sample2 %in% ped.table$Individual.ID)){

		info1 =  ped.table[as.character(ped.table$Individual.ID) == sample1,]
		info2 =  ped.table[as.character(ped.table$Individual.ID) == sample2,]
		
		if (info1$Family.ID != info2$Family.ID){
			relationship.category[i]="1000 Genomes (Different Families)"
		}else{
			if(as.character(info1$Paternal.ID) == sample2){
				#Father
				relationship.category[i]="1000 Genomes Parent-to-Child"
			}else if(as.character(info2$Paternal.ID) == sample1){
				#Father
				relationship.category[i]="1000 Genomes Parent-to-Child"
			}else if(as.character(info1$Maternal.ID) == sample2){
				#Mother
				relationship.category[i]="1000 Genomes Parent-to-Child"
			}else if(as.character(info1$Maternal.ID) == sample2){
				#Mother
				relationship.category[i]="1000 Genomes Parent-to-Child"
			}
		}#end else
	}#end if((sample1 %in% ped.table$Individual.ID)&(sample2 %in% ped.table$Individual.ID))

}#end for (i in 1:nrow(kin.table))

print(table(relationship.category))

#trio.ID1 = unique(as.character(kin.table$ID1[!is.na(relationship.category)&relationship.category == "1000 Genomes Parent-to-Child"]))
#trio.ID2 = unique(as.character(kin.table$ID2[!is.na(relationship.category)&relationship.category == "1000 Genomes Parent-to-Child"]))
#trioIDs = unique(c(trio.ID1,trio.ID2))
#print(trioIDs)

#LWK families have notes "Parent/Child directionality is uncertain"
#NA19444 (LWK003) and NA19434 (LWK003) have sibling mapping that I'm not showing in this version (and all individuals have "unrel" in Relationship column)

barplot.file = paste(output.prefix,".png",sep="")

kin.table = kin.table[!is.na(relationship.category),]
relationship.category = relationship.category[!is.na(relationship.category)]

#print(kin.table[(relationship.category == "1000 Genomes Parent-to-Child")&(kin.table$kinship < 0.1),])
#NA19742 is supposed to be the child of father NA19741

relationship.category = factor(relationship.category,
								levels = c("1000 Genomes (Different Families)","1000 Genomes Parent-to-Child","New"))


#require(graphics)
png(barplot.file)
par(mar=c(15,5,3,2))
plot(relationship.category, kin.table$kinship, col="gray40",
	ylab="plink kinship estimate", las=2, ylim=c(-0.6,0.6))
points(jitter(as.numeric(relationship.category)), kin.table$kinship, pch=16, col=rgb(red=0.5,blue=.5,green=.5,alpha=0.05))
dev.off()